<!-- blog/templates/blog/index.html -->
{% extends "base.html" %}


{% block page_content %}
    {% block posts %}
       {% with posts|length as posts_length  %}
       <div class="OpenTA-post-list">
        {% for post in posts %}
	  <div class="OpenTA-post-entry">
	   {% if posts_length > 1 %}
            <span class="OpenTA-toggle">
		    {{ post.categories.name }} 
	        <button   id="hide{{ post.pk }}" onClick=toggle({{ post.pk }}) class="OpenTA-show-button">
			<i class="fa-solid fa-chevron-down"></i> </button> 
		<button  id="show{{ post.pk }}" onClick=toggle({{ post.pk }}) class="OpenTA-hide-button hidden">
			<i class="fa-solid fa-chevron-up"></i> </button> 
		<a href="{% url 'blog_leave_comment' post.pk %}">{{ post.title }}</a>



	    </span>
	    <div id={{ post.pk}} class="hidden"> 
		    {{ post.body | safe |  slice:":400" }} 
	    </div>
	  </div>
	  {% else %}
 	<div class="px-0">
            <span class="px-0">
		{{ post.title }} {{ post.last_modified }} 
 

	    </span>
	    <div id="NOHIDE{{ post.pk}}" class="px-0"> 
		    {{ post.body | safe  }} 
	    </div>
	    {% endif %}
	    <div> 
<a class="OpenTA-leave-comment-link" href="{% url 'blog_leave_comment' post.pk %}"> {{ post.comments | length }} Leave a comment </a>
	    </div> 
	<button   id="hide{{ post.pk }}c" onClick=toggle("{{ post.pk }}c") class="OpenTA-show-button"> <i class="fa-solid fa-chevron-down"></i>  {{ post.comments | length }} comments </button> 
	<button  id="show{{ post.pk }}c" onClick=toggle("{{ post.pk }}c") class="OpenTA-hidden-button hidden"> <i class="fa-solid fa-chevron-up"></i> {{ post.comments | length }} comment </button> 
  <div id="{{ post.pk }}c"class="OpenTA-comment-list hidden ">
    {% for comment in post.comments %}
      <div class="OpenTA-comment-entry">

     {% if comment.author != "" %}
        <p> On {{ comment.created_on.date }} <b>{{ comment.author }}</b> wrote: </p>
     {% else %}
	<p> On {{ comment.created_on.date }} <b>Anon </b> wrote: </p>
     {% endif %}


     	<div class="OpenTA-comment-body">
            {{ comment.body | safe | linebreaks }}
	</div> 
    </div>
    {% endfor %}
  </div>
	</div>
</div>


{% endfor %}
</div>
{% endwith %}
{% endblock posts %}


{% endblock page_content %}

