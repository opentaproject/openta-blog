<!-- blog/templates/blog/index.html -->
{% extends "base.html" %}


{% block page_content %}
    {% block posts %}
       {% with posts|length as posts_length  %}
        {% for post in posts %}
	  <div class="p-2">
	   {% if posts_length > 1 %}
            <span class="sm:italic">
		    {{ post.categories.name }} 
	        <button   id="hide{{ post.pk }}" onClick=toggle({{ post.pk }}) class="bg-red-500">
			<i class="fa-solid fa-chevron-down"></i> </button> 
		<button  id="show{{ post.pk }}" onClick=toggle({{ post.pk }}) class="hidden bg-green-500">
			<i class="fa-solid fa-chevron-up"></i> </button> 
		<a href="{% url 'blog_leave_comment' post.pk %}">{{ post.title }}</a>



	    </span>
	    <div id={{ post.pk}} class="px-0 hidden "> 
		    {{ post.body | safe |  slice:":400" }} 
	    </div>
	  </div>
	  {% else %}
 	<div class="p-2">
            <span class="sm:italic">
		{{ post.title }}

	    </span>
	    <div id="NOHIDE{{ post.pk}}" class="px-0"> 
		    {{ post.body | safe |  slice:":400" }} 
	    </div>
	    {% endif %}
	<button   id="hide{{ post.pk }}c" onClick=toggle("{{ post.pk }}c") class="bg-red-500"> <i class="fa-solid fa-chevron-down"></i>  {{ post.comments | length }} comments </button> 
	<button  id="show{{ post.pk }}c" onClick=toggle("{{ post.pk }}c") class="hidden bg-green-500"> <i class="fa-solid fa-chevron-up"></i> {{ post.comments | length }} comment </button> 
  <div id="{{ post.pk }}c"class="px-0 hidden ">
    {% for comment in post.comments %}
      <div class="p-2">
     {% if comment.author != "" %}
        <p> On {{ comment.created_on.date }} <b>{{ comment.author }}</b> wrote: </p>
     {% else %}
	<p> On {{ comment.created_on.date }} <b>Anon </b> wrote: </p>
     {% endif %}
     	<div class="p-1 bg-post_body_color">
            {{ comment.body | safe | linebreaks }}
	</div> 
    </div>
    {% endfor %}
  </div>
	</div>
<a class="bg-red-400" href="{% url 'blog_leave_comment' post.pk %}"> {{ post.comments | length }} Leave a comment </a>
</div>


{% endfor %}
{% endwith %}
{% endblock posts %}


{% endblock page_content %}

