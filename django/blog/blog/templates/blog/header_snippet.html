{% block category %}


    <ul class="OpenTA-navigation-bar">
        {% for category in categories %}
	<li class="OpenTA-text-size -mb-px mr-1"> 


                {% if category.pk == category_selected %}
		<a class="OpenTA-category-selected" href="/blog/{{ category.pk }}/">{{ category }}   </a> 

	</li>
                {% else %}
                    <li class="mr-1">
                        <a class="OpenTA-category-not-selected" href="/blog/{{ category.pk }}/">{{ category }}</a>
                    </li>
                {% endif %}
        {% endfor %}
    </ul>






{% endblock category %}


{% block subcategory %}


    <ul class="OpenTA-subcategories">
        {% for category in categories %}
{% if category.pk == category_selected %}
	<li class="OpenTA-text-size -mb-px mr-1"> 

		<form method="post">
			<label for="id_filterkey_all" > <input type="checkbox" name="option" value="All" id="All" > All </input>
			</label>
		{% for f in category.get_filterkeys %} 
		{{ style }} 
		{% if f.name %}
			<label for="id_filterkey_{{f.pk}}">
				{% if filter_key.pk == f.pk %}
				<input type="checkbox" name="option" value="{{ f.get_posts }}" id="id_filterkey_{{f.pk}}" checked>  {{ f.title | truncatechars:20 | safe }}  <span class="OpenTA-debug"> {{ f.get_posts }} </span> </input> 
				{% else %}
				<input type="checkbox" name="option" value="{{ f.get_posts }}" id="id_filterkey_{{f.pk}}">  {{ f.title| truncatechars:20  | safe  }}  <span class="OpenTA-debug"> {{ f.get_posts }} </span> </input> 

				{% endif %}
			</label>
		{% else %} <span> EMPTY </span>
		{% endif %}
		{% endfor %}
		</form>

	</li>
      {% endif %}
        {% endfor %}
    </ul>
    <script>
        // Function to assign 'count' attribute to visible elements
        function count_visible(posts) {
	    var count = 0
	    console.log("COUNT_VISIBLE")
	    for (var i = 0; i < posts.length; i++) {
		    if ( posts[i].classList.contains('visible' ) ){
			    count ++ ;
			    console.log("COUNT = ", count )
		    }
		}
	    	return posts
	}
    </script>


    <script>
	function make_hidden( posts ){ for (var i = 0; i < posts.length; i++) {
                        posts[i].classList.remove('visible') ; // Do something with each element
                        posts[i].classList.add('hidden') ; // Do something with each element
                         }
		return posts
                }

        function make_visible( posts ){ for (var i = 0; i < posts.length; i++) {
                        posts[i].classList.remove('hidden') ; // Do something with each element
                        posts[i].classList.add('visible') ; // Do something with each element
                         }
		return posts
                }
	function hideshow( a ) {
		console.log("A =", a)
		var posts =  document.getElementsByClassName('post');
		var ckall =  document.getElementById('All')
		var ck = ckall.checked
		posts = make_hidden( posts )
		//for (var i = 0; i < posts.length; i++) {
	        //		posts[i].classList.remove('visible') ; // Do something with each element
		//	        posts[i].classList.add('hidden') ; // Do something with each element
		//	       	 }

		if ( String(a) == 'All' ){
		       const checkedboxes = document.querySelectorAll('input[name="option"]:checked');
		       for ( let i = 0 ; i < checkedboxes.length ; i++ ){ 
				checkedboxes[i].checked = false 
			     } document.getElementsByClassName('post hidden')
		        ckall.checked = ck
			if (ck ){
				posts = make_visible( posts )
		     		//for (var i = 0; i < posts.length; i++) {
		       		//	posts[i].classList.remove('hidden') ; // Do something with each element
		       		//	posts[i].classList.add('visible') ; // Do something with each element
		       		//	}
			} else {
				posts = make_hidden( posts )
		    		//for (var i = 0; i < posts.length; i++) {
				//	posts[i].classList.remove('visible') ; // Do something with each element
		       		//	posts[i].classList.add('hidden') ; // Do something with each element
		       		//	}
			}
		} else {var posts =  document.getElementsByClassName('post');

			if (ck ){ 
				posts = make_visible( posts )
		     		//for (var i = 0; i < posts.length; i++) {
		       		//	posts[i].classList.remove('hidden') ; // Do something with each element
		       		//	posts[i].classList.add('visible') ; // Do something with each element
		       		//	}
			} else {
				posts = make_hidden( posts )
		    		//for (var i = 0; i < posts.length; i++) {
				//	posts[i].classList.remove('visible') ; // Do something with each element
		       		//       posts[i].classList.add('hidden') ; // Do something with each element
		         	//}
			}
		 try { var acopy = JSON.parse( a ); } catch (error ){ var acopy = a }
    		 const checkedboxes = document.querySelectorAll('input[name="option"]:checked');
		 var ar = []
		 var rid = []
		 for ( let i = 0 ; i < checkedboxes.length ; i++ ){ 
			 if( checkedboxes[i].value != 'All'  ){
			 ar = ar.concat( JSON.parse(checkedboxes[i].value ) ); 
			 rid = rid.concat( [ checkedboxes[i].id  ] )  
			 } document.getElementsByClassName('post hidden')
		 	} document.getElementsByClassName('post hidden')
		  for (var i = 0; i < posts.length; i++) {
			posts[i].classList.remove('visible') ; // Do something with each element
		        posts[i].classList.add('hidden') ; // Do something with each element
		       	 }var posts =  document.getElementsByClassName('post');


		 for ( let i = 0 ; i <  ar.length ; i++ ){ document.getElementById( 'post_' + String( ar[i] )   ).classList.replace('hidden','visible')  ; console.log('post_' +  String( ar[i] ) ) } 
		 const postchecks = document.getElementById( 'post_' + acopy[i] );
		 console.log("ar = ", ar )
		 console.log("rid = ", rid , rid.length)
		 var fk = document.getElementById("filter_key_selected"); if ( fk ) { fk.value = rid } 
		 ckall.checked = false;
		}
	 posts = count_visible(posts)
	}
        // Select all radio buttons with the name 'option'
        const checkboxButtons = document.querySelectorAll('input[name="option"]');
        checkboxButtons.forEach((checkbox) => {
            checkbox.addEventListener('change', () => {
			hideshow(  checkbox.value )
            });
        });
    </script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const nhidden  = document.getElementsByClassName('post hidden').length;
        console.log('Number of posts with class "hidden":', nhidden );
	if ( nhidden == 0 ){
		console.log("ALL SHOWN ")
		document.getElementById('All').checked = true
	}
	else {
		console.log("SOME HIDDEN")

	}
	var posts =  document.getElementsByClassName('post');
	posts = count_visible( posts )

    });
</script>





{% endblock subcategory %}
